---
layout: default
title: Introduction
output: bookdown::html_chapter
---

# Introduction

## Why build a package?

> Seriously, it doesnâ€™t have to be about sharing your code (although that 
> is an added benefit!). It is about saving yourself time. (n.b. this is 
> my attitude about all reproducibility.)
>
> --- Hilary Parker

In R, the fundamental unit of shareable code is the package. A package bundles together code, data, documentation and tests. It's easy to share with others.

At their heart, packages are quite simple and only have two essential components: 

* a `DESCRIPTION` file that describes the package, what it does, who's allowed
  to use it (the license) and who to contact if you need help

* an `R/` directory that contains your R code.

If you want to distribute R code to someone else, there's no excuse not to use a simple package: it's a standard structure, and you can easily expand on it by adding documentation, data and tests.

The most accurate resource for up-to-date details on package development is always the official [writing R extensions][r-ext] guide. However, it's rather hard to read and follow if you're not already familiar with the basics of packages. It's also exhaustive, covering every possible package component, rather than focussing on the most common and useful components as this package does. Once you are familiar with the content here, you should find R extensions a little easier to read.

## Philosophy

This book espouses a particular philosophy of package development - it is not shared by all R developers, but it is one connected to a specific set of tools that makes package development as easy as possible. Central to my philosophy is that anything that can be automated, should be automated. 

There are three packages we will use extensively:

* `devtools`, which provides a set of R functions that makes package
  development as easy as possible.

* `roxygen2`, which translates source code comments into R's official
  documentation format (with contributions from Peter Danenburg and 
  Manuel Eugster).

* `testthat`, which provides a friendly unit testing framework for R.

Other styles of package development don't use these packages, but in my experience they provide a useful trade off between speed and rigour. That's a theme that you'll see a lot in this book: base R provides rigorous tools that guarantee correctness, but tend to be slow. Sometimes you want to be able to iterate more rapidly.

The goal of the devtools package is to make package development as painless as possible by encoding package building best practices in functions (so you don't have to remember, or even know about them), and by minimising the iteration time when you're developing a package.

These tools should be more reliable than running the equivalent commands in the terminal (and much easier to use if you're not familiar with the terminal). They do more to ensure that command-line R is running in exactly the same way as your R GUI. They check that you're running the same version of R, with the same library paths, and with a standard collation order. These are things you don't need to worry about most of the time, but if they ever trip you up, it can take hours to figure out the source of the problem. `check()` and `install()` also run build first, which is recommended best practice.

A package doesn't need to be complicated. You can start with a minimal subset of useful features and slowly build up over time. While there are strict requirements if you want to publish a package to the world on CRAN (and many of those requirements are useful even for your own packages), most packages won't end up on CRAN. Packages are really easy to create and use once you have the right set of tools.

Anytime you create some reusable set of functions you should put it in a package. It's the easiest path because packages come with conventions: you don't need to figure them out for yourself. You'll start with just your R code in the `R/` directory, and over time you can flesh it out with documentation (in `man/`), compiled code (in `src/`), data sets (in `data/`), and tests (in `inst/tests`).

## Getting started

To get started, make sure you have the latest version of R: if you want to submit your work to CRAN, you'll need to make sure you're running all checks with the latest R.

You can install the packages you need for this book with:

```{r, eval = FALSE}
install.packages(c("devtools", "roxygen2", "testthat", "knitr"))
```

You'll also need to make sure you have the appropriate development tools installed. If you're on windows or the mac, Rstudio will install these for you if you don't have them already. Otherwise:

* On Windows, download and install [Rtools](http://cran.r-project.org/bin/windows/Rtools/). NB: this is not an R package!

* On Mac, make sure you have either XCode (free, available in the app store)
  or the ["Command Line Tools for Xcode"](http://developer.apple.com/downloads)
  (needs a free apple id).

* On Linux, make sure you've installed not only R, but the R development
  devtools. This is a Linux package called something like `r-base-dev`.

You can check you have everything installed and working by running this code:

```{r, message = FALSE}
library(devtools)
has_devel()
```

It will print out some compilation code (this is needed to help diagnose problems), but you're only interested in whether it returns `TRUE` (everything's ok) or an error (which you need to investigate further).

## Package basics

This book is arranged according to the structure of an R package. It starts with the most commonly used components, and then gets more esoteric.

* the `R/` directory where your R code lives (in `.R` or `.r` files).

* the `DESCRIPTION` file, which provides metadata about the package, and is
  described in the following section.

* the `man/` directory where your [[function documentation|documenting-functions]]. In
  the style of package development described in this book, you'll never
  personally touch the files in this directory. Instead, they will be
  automatically generated from comments in your source code using the
  `roxygen2` package

* the `vignettes/` directory is used for larger scale documentation, like
  vignettes, long-form documents which show how to combine multiple parts
  of your package to solve problems.

* a `NAMESPACE` file describes which functions are part of the formal API of
  the package and are available for others to use. See [[namespaces]] for more
  details.

* `tests/` contains [[unit tests|testing]] which ensure that
  your package is operating as designed. In this book, we'll focus on the
  `testthat` package for writing tests.

* the `data/` directory contains `.rdata` files, used to include sample
  datasets (or other R objects) with your package.

* `src/`: C, C++ and fortran source code

[r-ext]:http://cran.r-project.org/doc/manuals/R-exts.html#Creating-R-packages
