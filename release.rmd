---
title: Releasing a package
layout: default
output: bookdown::html_chapter
---

# Releasing a package {#release}

If you want your package to have significant traction in the R community, you need to submit it to CRAN. Submitting to CRAN is a lot more work than just providing a version on github, but the vast majority of R users do not install packages from github. The CRAN submission process can be frustrating, but it's worthwhile, and this chapter will make it as painless as possible.

Follow these steps when your package is ready for release:

1. Update `README.md` and `NEWS.md`.
1. Document your `R CMD check` process.
1. Submit the package to CRAN.
1. Prepare for the next version.
1. Publicise the new version.

## Important files

* `NEWS` or `NEWS.md` describes the changes in each version of the package. 
  Using the standard R format will allow you to take advantage of automated
  tools for displaying changes between versions. Using markdown makes it 
  easy to describe in github releases.

* the `README.md` file gives a general overview of your package, including why
  it's important. This text should be included in any package announcement, to
  help others understand why they might want to use your package.

### README.md {#readme}

The `README.md` file lives in the package directory. It should be fairly short (3-4 paragraphs) and answer the following questions:

* Why should someone use your package?
* How does it compare to other existing solutions?
* What are the main functions?

If you're using github, this will appear on the package home page. I also recommend using it when you announce a new version of your package. 

See [markdown](#markdown) for more details on markdown.

### NEWS.md {#news}

The `NEWS` file should list all changes that have occurred since the last release of the package.

Three ways to write NEWS:

* Plain text (with special formatting)
* Markdown
* `Rd`.

The following sample shows the `NEWS` file from the `stringr` package.

    stringr 0.5
    ===========

    * new `str_wrap` function which gives `strwrap` output in a more
      convenient format

    * new `word` function extract words from a string given user defined
      separator (thanks to suggestion by David Cooper)

    * `str_locate` now returns consistent type when matching empty string
      (thanks to Stavros Macrakis)

    * new `str_count` counts number of matches in a string.

    * `str_pad` and `str_trim` receive performance tweaks - for large vectors
      this should give at least a two order of magnitude speed up

    * str_length returns NA for invalid multibyte strings

    * fix small bug in internal `recyclable` function

`NEWS` has a special format, but it's not well documented. The basics are:

* The information for each version should start with the name of the package
  and its version number, followed by a line of `=`s.

* Each change should be listed with a bullet. If a bullet continues over
  multiple lines, the second and subsequent lines need to be indented by at
  least two spaces. (I usually add a blank line between each bullet to make it
  easier to read.)

* If you have many changes, you can use subheadings to divide them into
  sections. A subheading should be all upper case and flush left.

* I use markdown formatting inside the bullets. This doesn't help the
  formatting in R, but is useful if you want to publish the `NEWS` file
  elsewhere.

You can use `devtools::show_news()` to display the `NEWS` using R's built-in parser and check that it appears correctly. `show_news()` defaults to showing just the news for the most recent version of the package.

Another option is to write `NEWS.md`.  

* Can't include in package (needs to be in `.Rbuildignore`), and so not 
  on CRAN.
* Easier to read on github
* Easier to copy-and-paste into github releases.

## The check process {#release-check}

[Checking](#check) described how to run `R CMD check`. For release to CRAN, you need to both run it and document it.

The most important thing to understand about CRAN is that it's staffed by volunteers and its a lot of work. In a typical week, CRAN recieves around 130 packages, and there are only 3 volunteers to process all the submissions. Anything you can do to make their lives easier is appreciated.

You must ensure that `R CMD check` passes with no ERRORs or WARNINGs, and you should strive to minimise the number of NOTEs. If there are notes that you do not believe are important, it is almost always easier to hack around them than to persuade CRAN that they're ok. The release process for a package with no NOTEs is much smoother.

In `cran-comments.md` include a bulleted list with one bullet for each note. Make sure it's listed in `.Rbuildignore`. Check into source code control, and modify prior to release. Use markdown (loosely). It should start by saying how you've tested the package. Copy and paste the message from `R CMD check` and include a brief description of why you believe the NOTE is a false-positive. The goal is to create a file that the CRAN maintainers can easily use.

For example, here's the relevent bit of `cran-comments.md` for a recent version of devtools:

```
* checking dependencies in R code ... NOTE
  Namespace in Imports field not imported from: ‘memoise’
  All declared Imports should be used.
  
  memoise is a build-time dependency.

* checking R code for possible problems ... NOTE
  Found the following calls to attach():
    File 'devtools/R/package-env.r':
      attach(NULL, name = pkg_env_name(pkg))
    File 'devtools/R/shims.r':
      attach(e, name = "devtools_shims", warn.conflicts = FALSE)

  These are needed because devtools simulates package loading, and hence
  needs to attach environments to the search path.
```

* R-devel
* Cross-platform
* Dependencies

### R-devel

It's a good idea to check your package with the nightly version of R-devel. The checks are constantly changing and you have to keep up. The easiest way to do this is to: XYZ.

### Cross-platform checking

I highly recommend running `R CMD check` on at least two platforms:

* On windows: windows + linux
* On linux: linux + windows
* On OS X: os x + linux + windows

You can check packages on Windows using `build_win()`. This builds your package and submits it to the CRAN win-builder. 30-60 minutes after submission, you'll recieve and email which will point you to the check results. By default `build_win()` checks with both the release and development version of R. You can override this with the version parameter.

I hope that in the future we'll see more services like `build_win()` that allow you to check your package on multiple platforms without having to setup all the infrastructure yourself.

### Checking dependencies

If you are releasing a new version of an existing package, it's your responsibility to ensure that all packages that rely on your package continue to work.  

If any packages fail `R CMD check`, you should give package authors at least two weeks to fix the problem before you submit your package to CRAN.  After the two weeks is up, re-run the checks, and list any remaining failures in `cran-comments.md`. Each package should be accompanied  brief explanation - either that it's a false positive in `R CMD check` or a legitimate change in the API. Inform CRAN of your release process: "I advised all downstream packages maintainers of these problems two weeks ago". Here's an example from a recent release of httr:

```
I have also run R CMD check on downstream dependencies of httr. Results are 
available at R release: https://github.com/wch/checkresults/blob/master/httr/r-release.
Potential problems:

* Ecoengine: this appears to be a failure related to config on that machine,
  I couldn't reproduce locally, and it doesn't seem to be related to changes 
  in httr (the same problem exists with httr 0.4).
```

### CRAN policies

You must be familiar with [CRAN policies](http://cran.r-project.org/web/packages/policies.html). I recommending following the [CRAN Policy Watch](https://twitter.com/CRANPolicyWatch) twitter account which is automatically updated whenever the policies change. Alternatively you can look at the history at <https://github.com/eddelbuettel/crp/commits/master/texi>.

Most important points:

* Must have clearly identified IP holders in `DESCRIPTION`, have open source 
  license (so CRAN can distribute it) and not include any files that can not
  be generated from "source".

* It is vital that maintainer email address is stable. This is the only way
  that CRAN has to contact you, and they will remove your package from CRAN
  if there are problems and they can't get in touch with. Make sure it's 
  something that's likely to be around for a while, and that it's not heavily 
  filtered.

* Packages shouldn't make external changes without explicit user permission.
  Don't write to the file system, change options, install packages, quit R, 
  send information over the internet, open external software, etc.

## Release

Once you've run the automated checks on you need to upload your package to CRAN. I recommend using `devtools::release()` which asks a number of questions to make sure that you're ready, then builds, uploads and submits for you.

* Adding extra questions
* Comments to CRAN

On failure, make the suggested changes, update `cran-comments.md` describing what you did and why, and re-run `release()`. CRAN prefers you to not respond to their emails unless discussion is required.

Failures are frustrating, and the response you receive may be curt or downright insulting. Unfortunately no recourse is available, so you just have to develop a thick skin. You're not alone: even members of R-core have to go through the same gruelling process, and CRAN is no friendlier to them. Try not to get upset by the feedback. Ignore any ad hominen attacks, and simply respond to the technical content. 

Devtools comes with a small guarantee to make life a little more pleasant: If a CRAN maintainer is annoyed with you because devtools did something wrong, I will send you a hand-written apology card. Please send me an email with your address.

### Binary builds

After the package has been accepted by CRAN it will be built for each platform. It's possible this may uncover further errors.

## Prepare for next version {#post-release}

Once you've received confirmation that all checks have passed on all platforms, you have a couple of technical operations to do:

* Github release/`git tag`, so you can mark exactly what version of the code this release
  corresponds to. If you use github, use github releases - copy and paste
  the relevant portion of the NEWS file (converting to markdown if needed).

* bump version in `DESCRIPTION` and `NEWS` files. Use `.9000` prefix to 
  indicate that it's a development version.

* git commit and push

## Promotion {#promotion}

Then you need to publicise your package.  This is vitally important - for your hard work to be useful to someone, they need to know that it exists!

Start by writing a release announcement. This should be an Rmarkdown document that briefly describes what the package does (so people who haven't used it before can understand why they might care), and what's new in this version.  Start with what you've listed in `NEWS.md`, but the goal in the release announcement is not to be comprehensive, it's to highlight the most important new features.You can include a link at the end of the announcement to the full release notes so people can see all the changes. Where possible, I recommend showing examples of the new features: it's much easier to understand the benefit of a new feature if you can see it in action. 

There are a number of places you can include the announcemnt:

* If you have a blog, publish it there. I now publish all package release
  announcements on the [RStudio blog](http://blog.rstudio.org/author/hadleywickham/).
* If you use twitter, tweet about it.
* Send it to the r-packages mailing list.
